from datetime import datetime


# Define adding expenses mechanism
def add_expense(expenses):

    # Asks user to enter a category, item, amount, and the date
    try:
        category = input("Enter category: ")
        item = input("Enter item name: ")
        amount = float(input("Enter amount: $"))
        date_input = input("Enter date (YYYY-MM-DD): ")

        # Converts string into real date format
        date = datetime.strptime(date_input, "%Y-%m-%d")

        # Stores expense as a dictionary
        expense = {
            "category": category,
            "item": item,
            "amount": amount,
            "date": date
        }

        # Adds expense to expense list
        expenses.append(expense)
        print("Expense added successfully ‚úÖ")

    # Shows when user enters invalid amount or date format
    except ValueError:
        print("Invalid amount or date format. Please try again.")


# Displays all expenses in a clear, organized format.
def view_expenses(expenses):

    # Checks if the list is empty
    if not expenses:
        print("No expenses recorded.")
        return

    print("\nAll Expenses:")

    # Loop through each expense
    for i, expense in enumerate(expenses, start=1):
        print(
            f"{i}. {expense['date'].strftime('%Y-%m-%d')} | "
            f"{expense['category']} | "
            f"{expense['item']} | "
            f"${expense['amount']:.2f}"
        )


# Calculates and displays total expenses.
def calculate_total(expenses):

    # Checks if there are expenses to calculate
    if not expenses:
        print("No expenses to calculate.")
        return

    total = 0  # Starts total at 0

    # Adds each expense amount to total
    for expense in expenses:
        total += expense["amount"]

    # Shows total with 2 decimal places
    print(f"Total expenses: ${total:.2f}")


# Filters expenses by category.
def filter_by_category(expenses):

    # Asks user what category they want to see
    category = input("Enter category to filter by: ")
    found = False  # Checks if match is found

    # Loop through each expense
    for expense in expenses:

        # Checks if user input matches category
        if expense["category"].lower() == category.lower():
            print(
                f"{expense['date'].strftime('%Y-%m-%d')} | "
                f"{expense['category']} | "
                f"{expense['item']} | "
                f"${expense['amount']:.2f}"
            )
            found = True

    # Shows if no matches found
    if not found:
        print("No expenses found for this category.")


# Deletes an expense by category, item, and date.
def delete_expense(expenses):

    # Checks if there are expenses to delete
    if not expenses:
        print("No expenses to delete.")
        return

    # Asks user for expense information
    category = input("Enter category: ")
    item = input("Enter item name: ")
    date_input = input("Enter date (YYYY-MM-DD): ")

    try:
        date = datetime.strptime(date_input, "%Y-%m-%d")

        # Loop through expenses
        for i, expense in enumerate(expenses):

            # Checks if information matches
            if (
                expense["category"].lower() == category.lower()
                and expense["item"].lower() == item.lower()
                and expense["date"] == date
            ):
                # Removes matching expense
                del expenses[i]
                print("Expense deleted successfully üóëÔ∏è")
                return

        print("No matching expense found.")

    except ValueError:
        print("Invalid date format.")


# Sorts and displays expenses by date (earliest to latest).
def sort_by_date(expenses):

    # Checks if there are expenses to sort
    if not expenses:
        print("No expenses to sort.")
        return

    # Sorts by date
    sorted_expenses = sorted(expenses, key=lambda expense: expense["date"])

    print("\nExpenses Sorted by Date:")

    for expense in sorted_expenses:
        print(
            f"{expense['date'].strftime('%Y-%m-%d')} | "
            f"{expense['category']} | "
            f"{expense['item']} | "
            f"${expense['amount']:.2f}"
        )


# Creates summary of expenses by week, month, or year.
def expense_summary(expenses):

    # Checks if there are expenses recorded
    if not expenses:
        print("No expenses recorded.")
        return

    print("\nExpense Summary Options")
    print("1. Weekly Summary")
    print("2. Monthly Summary")
    print("3. Yearly Summary")

    choice = input("Choose summary type: ")

    summary = {}  # Regular dictionary

    # Groups expenses depending on choice
    for expense in expenses:

        if choice == "1":
            key = expense["date"].strftime("%Y-W%U")  # Group by week

        elif choice == "2":
            key = expense["date"].strftime("%Y-%m")   # Group by month

        elif choice == "3":
            key = expense["date"].strftime("%Y")      # Group by year

        else:
            print("Invalid choice.")
            return

        # If time period not in dictionary, start at 0
        if key not in summary:
            summary[key] = 0

        # Add expense amount to that period
        summary[key] += expense["amount"]

    # Displays summary
    print("\nExpense Summary:")

    for period in sorted(summary):
        print(f"{period}: ${summary[period]:.2f}")


def main():
    expenses = []

    while True:
        print("\nExpense Tracker Menu")
        print("1. Add Expense")
        print("2. View All Expenses")
        print("3. Filter Expenses by Category")
        print("4. Calculate Total Expenses")
        print("5. Delete Expense")
        print("6. Sort Expenses by Date")
        print("7. Expense Summary")
        print("8. Exit üö®")

        choice = input("Choose an option: ") #Asks user to choose from menu

        if choice == "1":
            add_expense(expenses)
        elif choice == "2":
            view_expenses(expenses)
        elif choice == "3":
            filter_by_category(expenses)
        elif choice == "4":
            calculate_total(expenses)
        elif choice == "5":
            delete_expense(expenses)
        elif choice == "6":
            sort_by_date(expenses)
        elif choice == "7":
            expense_summary(expenses)
        elif choice == "8":
            print("Goodbye üëã")
            break
        else:
            print("Invalid option. Please try again.")


main()
